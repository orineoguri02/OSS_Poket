// Prisma 스키마 파일
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL") // 또는 DATABASE_URL
}

model User {
  user_id   String   @id @db.VarChar(255)
  email     String   @db.VarChar(255)
  name      String   @db.VarChar(255)
  picture   String?  @db.Text
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @updatedAt @db.Timestamp(6)

  pokemon UserPokemon[]

  @@map("users")
}

model UserPokemon {
  id         Int      @id @default(autoincrement())
  user_id    String   @db.VarChar(255)
  pokemon_id Int
  added_at   DateTime @default(now()) @db.Timestamp(6)

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, pokemon_id])
  @@index([user_id])
  @@index([pokemon_id])
  @@map("user_pokemon")
}

model PokemonModel {
  id            Int      @id @default(autoincrement())
  pokemon_id    Int      @unique
  model_path    String   @db.Text      // 원본 로컬 경로 (예: "/pokemon/1/pm0001_00_00.dae")
  cdn_url       String?  @db.Text      // CDN URL (예: "https://xxx.vercel-storage.com/pokemon/1/model.dae")
  model_type    String   @default("dae") // dae, fbx, obj, glb, gltf
  file_size     Int?                    // 파일 크기 (bytes)
  storage_type  String   @default("cdn") // "local" | "cdn"
  is_primary    Boolean  @default(true)  // 여러 모델 중 기본 모델
  file_exists   Boolean  @default(true)  // 파일 존재 여부
  created_at    DateTime @default(now()) @db.Timestamp(6)
  updated_at    DateTime @updatedAt @db.Timestamp(6)

  @@index([pokemon_id])
  @@map("pokemon_models")
}
